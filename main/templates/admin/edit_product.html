{% extends 'admin/layout.html' %}

{% block content %}
<div class="container mt-5">
    <h1 class="mb-4">Edit Product</h1>

    <form action="{{ url_for('edit_product', product_id=product.product_id) }}" method="POST" enctype="multipart/form-data">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        {% with messages = get_flashed_messages() %}
        {% if messages %}
            <div class="alert alert-info">
                {% for message in messages %}
                    <p>{{ message }}</p>
                {% endfor %}
            </div>
        {% endif %}
        {% endwith %}
        <!-- Product Name Field -->
        <div class="form-group">
            <label for="product_name">Product Name:</label>
            <input type="text" name="product_name" id="product_name"
                   class="form-control {% if errors.get('product_name') %}is-invalid{% endif %}"
                   value="{{ request.form.product_name or product.product_name }}" required>
            {% if errors.get('product_name') %}
                <div class="invalid-feedback">{{ errors['product_name'] }}</div>
            {% endif %}
        </div>

        <!-- Description Field -->
        <div class="form-group">
            <label for="description">Description (HTML allowed):</label>
            <textarea name="description" id="description" class="form-control" rows="6" placeholder="Enter product description">{{ request.form.description or product.description | safe }}</textarea>
            <small class="form-text text-muted">You can use HTML tags like &lt;br&gt;, &lt;p&gt;, &lt;h1&gt;, etc.</small>
        </div>

        <!-- Price and Stock Fields -->
        <div class="form-row">
            <div class="form-group col-md-6">
                <label for="price">Price ($):</label>
                <input type="number" name="price" id="price" step="0.01" min="0"
                       class="form-control {% if errors.get('price') %}is-invalid{% endif %}"
                       value="{{ request.form.price or product.price }}" required>
                {% if errors.get('price') %}
                    <div class="invalid-feedback">{{ errors['price'] }}</div>
                {% endif %}
            </div>
            <div class="form-group col-md-6">
                <label for="stock_quantity">Stock Quantity:</label>
                <input type="number" name="stock_quantity" id="stock_quantity" min="0"
                       class="form-control {% if errors.get('stock_quantity') %}is-invalid{% endif %}"
                       value="{{ request.form.stock_quantity or product.stock_quantity }}" required>
                {% if errors.get('stock_quantity') %}
                    <div class="invalid-feedback">{{ errors['stock_quantity'] }}</div>
                {% endif %}
            </div>
        </div>

        <!-- Sizes and Colors Fields -->

        <div class="form-group">
            <label>Sizes:</label>
            <div class="d-flex flex-wrap gap-3">
                {% set size_options = ['XS', 'S', 'M', 'L', 'XL', 'XXL', '8', '8.5', '9', '9.5', '10', '10.5', '11', '11.5', '12', '12.5', '13'] %}
                {% for size in size_options %}
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="sizes" value="{{ size }}" id="size{{ size }}"
                        {% if size in request.form.getlist('sizes') %}checked{% endif %}>
                        <label class="form-check-label" for="size{{ size }}">{{ size }}</label>
                    </div>
                {% endfor %}
            </div>
        </div>

        <!-- Colors Selection (Horizontal Layout) -->
        <div class="form-group">
            <label>Colors:</label>
            <div class="d-flex flex-wrap gap-3">
                {% set color_options = [
                    'Red', 'Blue', 'White', 'Green', 'Black', 'Yellow', 'Purple', 'Orange', 
                    'Pink', 'Brown', 'Cyan', 'Magenta', 'Teal', 'Silver', 'Gold', 'Maroon'
                ] %}
                {% for color in color_options %}
                    <div class="form-check">
                        <input class="form-check-input color-checkbox" type="checkbox" name="colors" value="{{ color }}" id="color{{ color }}"
                               data-color="{{ color|lower }}"
                               {% if color in request.form.getlist('colors') %}checked{% endif %}>
                        <label class="form-check-label" for="color{{ color }}">{{ color }}</label>
                    </div>
                {% endfor %}
            </div>
            {% if errors.get('colors') %}
                <div class="invalid-feedback d-block">
                    {{ errors['colors'] }}
                </div>
            {% endif %}
        </div>
        <div class="form-group form-check">
            <input type="checkbox" class="form-check-input" id="is_featured" name="is_featured" {% if request.form.get('is_featured') %}checked{% endif %}>
            <label class="form-check-label" for="is_featured">Featured Product</label>
        </div>
        <!-- Images -->
        <div class="form-group">
            <label for="images">Images:</label>
            <input type="file" name="images" id="images" class="form-control-file" multiple>
            <div class="mt-3">
                {% for image in product.images %}
                <img src="{{ url_for('static', filename=image.image_url) }}" alt="{{ product.product_name }}" width="100" class="img-thumbnail">
                {% endfor %}
            </div>
        </div>

        <button type="submit" class="btn btn-primary">Update Product</button>
    </form>
</div>
{% endblock %}
